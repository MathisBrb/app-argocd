# Configuration complète pour OpenSearch 2.11.1
clusterName: "opensearch-cluster"
nodeGroup: "master"
replicas: 1
singleNode: true

image: opensearchproject/opensearch
imageTag: "2.11.1"

resources:
  requests:
    cpu: "500m"
    memory: "1Gi"
  limits:
    cpu: "1000m"
    memory: "2Gi"

persistence:
  enabled: true
  size: 10Gi

# ✅ SÉCURITÉ ACTIVÉE
config:
  opensearch.yml:
    cluster.name: "opensearch-cluster"
    node.name: "opensearch-cluster-master-0"
    plugins.security.disabled: false
    plugins.security.ssl.http.enabled: true
    plugins.security.ssl.http.pemcert_filepath: certs/node/node.pem
    plugins.security.ssl.http.pemkey_filepath: certs/node/node-key.pem
    plugins.security.ssl.http.pemtrustedcas_filepath: certs/ca/ca.pem
    plugins.security.ssl.transport.enforce_hostname_verification: false
    plugins.security.allow_unsafe_democertificates: true
    plugins.security.allow_default_init_securityindex: true

# ✅ MOT DE PASSE ADMIN
env:
  - name: OPENSEARCH_INITIAL_ADMIN_PASSWORD
    value: "AdminPassword123!"
  - name: OPENSEARCH_INITIAL_ADMIN_USER
    value: "admin"

# Probes
livenessProbe:
  tcpSocket:
    port: 9200
  initialDelaySeconds: 60
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /
    port: 9200
    scheme: HTTPS
  initialDelaySeconds: 60
  periodSeconds: 10

startupProbe:
  httpGet:
    path: /
    port: 9200
    scheme: HTTPS
  failureThreshold: 30
  periodSeconds: 10

service:
  type: ClusterIP
  port: 9200

plugins:
  securityPlugin: true
