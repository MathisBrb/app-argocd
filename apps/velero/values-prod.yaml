# On nettoie les anciennes configs
initContainers: []

# ‚ö†Ô∏è On d√©sactive la gestion des secrets par Helm (c'est Vault qui g√®re)
credentials:
  useSecret: false

configuration:
  provider: aws
  backupStorageLocation:
    name: default
    bucket: velero
    config:
      region: minio
      s3ForcePathStyle: true
      s3Url: http://minio.velero.svc:9000
  volumeSnapshotLocation:
    name: default
    config:
      region: minio

# üëá LA CONFIGURATION VAULT üëá
podAnnotations:
  # On active l'injecteur
  vault.hashicorp.com/agent-inject: "true"
  # On pr√©cise le r√¥le cr√©√© tout √† l'heure
  vault.hashicorp.com/role: "velero-role"
  # On demande le secret "secret/velero" et on veut l'√©crire dans un fichier "cloud"
  vault.hashicorp.com/agent-inject-secret-cloud: "secret/data/velero"
  # On formate le fichier pour qu'il ressemble exactement √† ce que Velero attend
  vault.hashicorp.com/agent-inject-template-cloud: |
    {{- with secret "secret/data/velero" -}}
    {{ .Data.data.cloud }}
    {{- end -}}

# On dit √† Velero : "Ton fichier de credentials est ici"
env:
  AWS_SHARED_CREDENTIALS_FILE: /vault/secrets/cloud
