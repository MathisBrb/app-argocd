# On d√©sactive les initContainers par d√©faut
initContainers: []

# On d√©sactive la cr√©ation de secret par Helm (c'est Vault qui g√®re)
credentials:
  useSecret: false

configuration:
  # Velero utilisera ce BSL pour √©crire les backups dans MinIO (bucket "velero")
  backupStorageLocation:
    - name: default
      provider: aws
      bucket: velero
      default: true
      config:
        region: minio
        s3ForcePathStyle: true
        # URL interne au cluster (service minio dans le namespace velero)
        s3Url: http://minio.velero.svc:9000

  # On laisse VSL pr√©sent (utile si tu ajoutes plus tard un snapshotter CSI)
  volumeSnapshotLocation:
    - name: default
      provider: aws
      config:
        region: minio

# Plugins n√©cessaires au support S3 (MinIO) + snapshots (optionnel)
# Le chart Velero attend une liste "initContainers" pour injecter les plugins.
initContainers:
  - name: velero-plugin-for-aws
    image: velero/velero-plugin-for-aws:v1.9.2
    imagePullPolicy: IfNotPresent
    volumeMounts:
      - mountPath: /target
        name: plugins

# üëá Configuration Vault (injection du fichier /vault/secrets/cloud)
podAnnotations:
  vault.hashicorp.com/agent-inject: "true"
  vault.hashicorp.com/role: "velero-role"
  vault.hashicorp.com/agent-inject-secret-cloud: "secret/data/velero"
  vault.hashicorp.com/agent-inject-template-cloud: |
    {{- with secret "secret/data/velero" -}}
    {{ .Data.data.cloud }}
    {{- end -}}

# On pointe Velero vers le fichier g√©n√©r√© par Vault
# Le contenu attendu est un format INI AWS, ex:
# [default]
# aws_access_key_id=...
# aws_secret_access_key=...
env:
  AWS_SHARED_CREDENTIALS_FILE: /vault/secrets/cloud

# Astuce: si tu veux exclure certains namespaces, configure "schedules" ou des BackupStorageLocation d√©di√©s.
